<UserControl x:Class="RauskuClaw.GUI.Views.HolviView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:fa="http://schemas.awesome.incremented/wpf/xaml/fontawesome.sharp"
             xmlns:wpf="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800"
             Background="#0F1115">
    <DockPanel>
        <Border DockPanel.Dock="Top"
                Background="#2A3240"
                Padding="10"
                BorderBrush="#1F2733"
                BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal">
                <Button Content="Open in browser"
                        Style="{StaticResource SecondaryButton}"
                        Command="{Binding OpenExternalCommand}"
                        Margin="0,0,8,0"/>
                <Button Content="Refresh"
                        Style="{StaticResource SecondaryButton}"
                        Command="{Binding RefreshCommand}"/>
            </StackPanel>
        </Border>

        <Border DockPanel.Dock="Top"
                Background="#D29922"
                Padding="16,12"
                Visibility="{Binding ShowVmRequiredWarning, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal">
                <fa:IconBlock Icon="ExclamationTriangle" Width="14" Height="14" Margin="0,0,8,0" Foreground="#0F1115" VerticalAlignment="Center"/>
                <TextBlock Text="VM is not running. Start the workspace to access HOLVI/Infisical."
                           FontWeight="SemiBold"
                           Foreground="#0F1115"/>
            </StackPanel>
        </Border>

        <Border DockPanel.Dock="Top"
                Background="#264A77"
                Padding="16,12"
                Visibility="{Binding IsConfigured, Converter={StaticResource InverseBoolToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal">
                <fa:IconBlock Icon="InfoCircle" Width="14" Height="14" Margin="0,0,8,0" Foreground="#E6EAF2" VerticalAlignment="Center"/>
                <TextBlock Text="HOLVI URL is not configured. Set Holvi Base URL in Settings."
                           FontWeight="SemiBold"
                           Foreground="#E6EAF2"/>
            </StackPanel>
        </Border>

        <Border DockPanel.Dock="Top"
                Background="#9E6A03"
                Padding="16,10"
                Visibility="{Binding IsInsecureRemoteUrl, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal">
                <fa:IconBlock Icon="ShieldAlt" Width="14" Height="14" Margin="0,0,8,0" Foreground="#0F1115" VerticalAlignment="Center"/>
                <TextBlock Text="Warning: Using HTTP for non-local host. Prefer HTTPS for remote HOLVI/Infisical endpoints."
                           FontWeight="SemiBold"
                           Foreground="#0F1115"/>
            </StackPanel>
        </Border>

        <Border DockPanel.Dock="Top"
                Background="#1E2A3D"
                BorderBrush="#2A3240"
                BorderThickness="0,0,0,1"
                Padding="16,12"
                Visibility="{Binding ShouldShowSetupPanel, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel>
                <StackPanel Orientation="Horizontal">
                    <fa:IconBlock Icon="Cogs" Width="14" Height="14" Margin="0,0,8,0" Foreground="#E6EAF2" VerticalAlignment="Center"/>
                    <TextBlock Text="HOLVI Setup"
                               FontWeight="SemiBold"
                               Foreground="#E6EAF2"/>
                </StackPanel>
                <TextBox x:Name="SetupStatusTextBox"
                         Text="{Binding SetupStatusText, Mode=OneWay}"
                         Foreground="#C7D0DE"
                         Background="#152033"
                         BorderBrush="#2A3240"
                         BorderThickness="1"
                         Margin="0,6,0,0"
                         Padding="8,6"
                         IsReadOnly="True"
                         IsReadOnlyCaretVisible="True"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Disabled"
                         MinHeight="120"
                         MaxHeight="300"
                         TextChanged="SetupStatusTextBox_TextChanged"/>
                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <Button Content="Run Setup"
                            Style="{StaticResource SecondaryButton}"
                            Command="{Binding RunSetupCommand}"
                            Margin="0,0,8,0"/>
                    <Button Content="Recheck"
                            Style="{StaticResource SecondaryButton}"
                            Command="{Binding RecheckSetupCommand}"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <wpf:WebView2 x:Name="WebView"
                      Source="{Binding CurrentUrl}"
                      DefaultBackgroundColor="#0F1115"
                      Visibility="{Binding ShouldShowWebView, Converter={StaticResource BoolToVisibilityConverter}}"/>
    </DockPanel>
</UserControl>
