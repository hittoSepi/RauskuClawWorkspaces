<Window x:Class="RauskuClaw.GUI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RauskuClaw.GUI.Views"
        xmlns:models="clr-namespace:RauskuClaw.Models"
        xmlns:viewModels="clr-namespace:RauskuClaw.GUI.ViewModels"
        xmlns:views="clr-namespace:RauskuClaw.GUI.Views"
        xmlns:fa="http://schemas.awesome.incremented/wpf/xaml/fontawesome.sharp"
        mc:Ignorable="d"
        Title="RauskuClaw - AI Workspaces"
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        ResizeMode="CanResize"
        MinWidth="1000"
        MinHeight="620"
        Background="#0F1115">
    <Border BorderBrush="#2A3240" BorderThickness="1" Background="#0F1115">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="64"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="0"
                  Background="#151A22"
                  MouseLeftButtonDown="TitleBar_OnMouseLeftButtonDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0"
                            Orientation="Horizontal"
                            Margin="12,0,0,0"
                            VerticalAlignment="Center">
                    <Image Width="32" Height="32" Source="pack://application:,,,/Assets/rausku-icon-64.png" Margin="0,0,10,0"/>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="RauskuClaw"
                                   Foreground="#4DA3FF"
                                   FontSize="27"
                                   FontWeight="Bold"
                                   LineHeight="27"/>
                        <TextBlock Text="AI Workspaces"
                                   Foreground="#9AA3B2"
                                   FontSize="11"
                                   Margin="0,-4,0,0"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Style="{StaticResource WindowTitleBarButtonStyle}" Click="MinimizeButton_OnClick">
                        <fa:IconBlock Icon="Minus"
                                      Width="10"
                                      Height="10"
                                      Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"/>
                    </Button>
                    <Button Style="{StaticResource WindowTitleBarButtonStyle}" Click="MaximizeRestoreButton_OnClick">
                        <fa:IconBlock Icon="WindowMaximize"
                                      Width="11"
                                      Height="11"
                                      VerticalAlignment="Center"
                                      Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"/>
                    </Button>
                    <Button Style="{StaticResource WindowTitleBarCloseButtonStyle}" Click="CloseButton_OnClick">
                        <fa:IconBlock Icon="Times"
                                      Width="10"
                                      Height="10"
                                      Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"/>
                    </Button>
                </StackPanel>
            </Grid>

            <DockPanel Grid.Row="1">
        <!-- Sidebar: Workspace List -->
        <Border DockPanel.Dock="Left" Width="280" Background="#151A22" BorderBrush="#2A3240" BorderThickness="0,0,1,0">
            <DockPanel>
                <!-- Header: App title + New button -->
                <StackPanel DockPanel.Dock="Top" Margin="16">
                    <TextBlock Text="Workspaces" FontSize="12" Foreground="#9AA3B2" Margin="0,0,0,12"/>
                    <Button Command="{Binding NewWorkspaceCommand}"
                            Style="{StaticResource SecondaryIconButton}"
                            Tag="Plus"
                            Content="New Workspace"
                            Padding="12,8"
                            Cursor="Hand"/>
                </StackPanel>

                <!-- Workspace List -->
                <ListBox ItemsSource="{Binding Workspaces}"
                         SelectedItem="{Binding SelectedWorkspace}"
                         Background="Transparent"
                         BorderThickness="0"
                         Padding="8"
                         Foreground="#E6EAF2">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Background="Transparent" Padding="8" Margin="0,4">
                                <DockPanel>
                                    <!-- Status indicator -->
                                    <Ellipse Width="8" Height="8"
                                             DockPanel.Dock="Right"
                                             Fill="{Binding StatusColor}"
                                             VerticalAlignment="Top"
                                             Margin="8,0,0,0"/>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}"
                                                   FontWeight="SemiBold"
                                                   Foreground="#E6EAF2"
                                                   FontSize="14"/>
                                        <TextBlock Text="{Binding Description}"
                                                   FontSize="11"
                                                   Foreground="#9AA3B2"
                                                   TextTrimming="CharacterEllipsis"
                                                   Margin="0,2,0,4"/>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="CPU:" FontSize="10" Foreground="#6A7382" Margin="0,0,4,0"/>
                                            <TextBlock Text="{Binding CpuCores}" FontSize="10" Foreground="#6A7382" Margin="0,0,12,0"/>
                                            <TextBlock Text="RAM:" FontSize="10" Foreground="#6A7382" Margin="0,0,4,0"/>
                                            <TextBlock Text="{Binding MemoryMb}" FontSize="10" Foreground="#6A7382"/>
                                        </StackPanel>
                                    </StackPanel>
                                </DockPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Setter Property="Padding" Value="0"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#2A3240"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#2A3240"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>

                <StackPanel DockPanel.Dock="Bottom" Margin="12,8,12,16">
                    <TextBlock Text="General" FontSize="12" Foreground="#9AA3B2" Margin="4,0,0,8"/>
                    <Button Command="{Binding ShowWorkspaceViewsCommand}"
                            Style="{StaticResource SecondaryIconButton}"
                            Tag="Desktop"
                            Content="Workspace Views"
                            Padding="10,8"
                            Margin="0,0,0,6"/>
                    <Button Command="{Binding ShowTemplatesCommand}"
                            Style="{StaticResource SecondaryIconButton}"
                            Tag="Clone"
                            Content="Templates"
                            Padding="10,8"
                            Margin="0,0,0,6"/>
                    <Button Command="{Binding ShowGeneralSettingsCommand}"
                            Style="{StaticResource SecondaryIconButton}"
                            Tag="Cog"
                            Content="General Settings"
                            Padding="10,8"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Main Content Area -->
        <DockPanel DockPanel.Dock="Right">
            <!-- Header: Workspace info + VM controls -->
            <Border DockPanel.Dock="Top"
                    Visibility="{Binding IsWorkspaceViewsSection, Converter={StaticResource BoolToVisibilityConverter}}"
                    Background="#151A22"
                    Padding="16,12"
                    BorderBrush="#2A3240"
                    BorderThickness="0,0,0,1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Workspace info -->
                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                        <TextBlock Text="{Binding SelectedWorkspace.Name}"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#E6EAF2"/>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="Status:" FontSize="12" Foreground="#9AA3B2"/>
                            <TextBlock Text="{Binding SelectedWorkspace.StatusText}"
                                       FontSize="12"
                                       Foreground="{Binding SelectedWorkspace.StatusColor}"
                                       Margin="6,0,0,0"/>
                            <Border Margin="10,0,0,0"
                                    Padding="8,2"
                                    CornerRadius="10"
                                    Background="#6E4B1A"
                                    BorderBrush="#D29922"
                                    BorderThickness="1">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedWorkspace.Status}" Value="{x:Static models:VmStatus.WarmingUp}">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <TextBlock Text="SSH warming up..."
                                           FontSize="11"
                                           Foreground="#F8D58B"
                                           FontWeight="SemiBold"/>
                            </Border>
                            <Border Margin="10,0,0,0"
                                    Padding="8,2"
                                    CornerRadius="10"
                                    Background="#4A1F24"
                                    BorderBrush="#DA3633"
                                    BorderThickness="1">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedWorkspace.Status}" Value="{x:Static models:VmStatus.WarmingUpTimeout}">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <TextBlock Text="SSH warmup timeout"
                                           FontSize="11"
                                           Foreground="#FF9B9B"
                                           FontWeight="SemiBold"/>
                            </Border>
                        </StackPanel>
                        <TextBlock Text="{Binding InlineNotice}"
                                   FontSize="11"
                                   Foreground="#4DA3FF"
                                   Margin="0,6,0,0"
                                   Visibility="{Binding HasInlineNotice, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    </StackPanel>

                    <!-- VM Control Buttons -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button
                                Command="{Binding StartVmCommand}"
                                Style="{StaticResource GreenIconButton}"
                                Tag="Play"
                                Content="Start"
                                Padding="16,8"
                                Margin="0,0,8,0"/>
                        <Button
                                Command="{Binding StopVmCommand}"
                                Style="{StaticResource RedIconButton}"
                                Tag="Stop"
                                Content="Stop"
                                Padding="16,8"
                                Margin="0,0,8,0"/>
                        <Button
                                Command="{Binding RestartVmCommand}"
                                Style="{StaticResource SecondaryIconButton}"
                                Tag="Refresh"
                                Content="Restart"
                                Padding="16,8"
                                Margin="0,0,8,0"/>
                        <Button
                                Command="{Binding DeleteWorkspaceCommand}"
                                Style="{StaticResource SecondaryIconButton}"
                                Tag="Trash"
                                Content="Delete"
                                Padding="16,8"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Quick Info Bar -->
            <Border DockPanel.Dock="Top"
                    Visibility="{Binding IsWorkspaceViewsSection, Converter={StaticResource BoolToVisibilityConverter}}"
                    Background="#0F1115"
                    Padding="12,8"
                    BorderBrush="#2A3240"
                    BorderThickness="0,0,0,1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="API" FontSize="10" Foreground="#6A7382"/>
                        <TextBlock Text="{Binding SelectedWorkspace.ApiUrl}" FontSize="11" Foreground="#E6EAF2"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1">
                        <TextBlock Text="Web UI" FontSize="10" Foreground="#6A7382"/>
                        <TextBlock Text="{Binding SelectedWorkspace.WebUiUrl}" FontSize="11" Foreground="#E6EAF2"/>
                    </StackPanel>
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="SSH" FontSize="10" Foreground="#6A7382"/>
                        <TextBlock Text="{Binding SelectedWorkspace.SshUrl}" FontSize="11" Foreground="#E6EAF2"/>
                    </StackPanel>
                    <StackPanel Grid.Column="3">
                        <TextBlock Text="Docker" FontSize="10" Foreground="#6A7382"/>
                        <TextBlock Text="{Binding SelectedWorkspace.DockerStatus}" FontSize="11" Foreground="#E6EAF2"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Tab Control: Views -->
            <TabControl Background="#0F1115" BorderThickness="0" Visibility="{Binding IsWorkspaceViewsSection, Converter={StaticResource BoolToVisibilityConverter}}">
                <TabItem Padding="16,8">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <fa:IconBlock Icon="Globe" Style="{StaticResource FaIconInline}"/>
                            <TextBlock Text="Web UI"/>
                        </StackPanel>
                    </TabItem.Header>
                    <ContentControl Content="{Binding WebUi}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate>
                                <views:WebUi/>
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </TabItem>
                <TabItem Padding="16,8">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <fa:IconBlock Icon="Terminal" Style="{StaticResource FaIconInline}"/>
                            <TextBlock Text="Serial Console"/>
                        </StackPanel>
                    </TabItem.Header>
                    <ContentControl Content="{Binding SerialConsole}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate>
                                <views:SerialConsole/>
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </TabItem>
                <TabItem Padding="16,8">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <fa:IconBlock Icon="Cubes" Style="{StaticResource FaIconInline}"/>
                            <TextBlock Text="Docker"/>
                        </StackPanel>
                    </TabItem.Header>
                    <ContentControl Content="{Binding DockerContainers}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate>
                                <views:DockerContainers/>
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </TabItem>
                <TabItem Padding="16,8">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <fa:IconBlock Icon="Terminal" Style="{StaticResource FaIconInline}"/>
                            <TextBlock Text="SSH Terminal"/>
                        </StackPanel>
                    </TabItem.Header>
                    <ContentControl Content="{Binding SshTerminal}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate>
                                <views:SshTerminal/>
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </TabItem>
                <TabItem Padding="16,8">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <fa:IconBlock Icon="FolderOpen" Style="{StaticResource FaIconInline}"/>
                            <TextBlock Text="SFTP"/>
                        </StackPanel>
                    </TabItem.Header>
                    <ContentControl Content="{Binding SftpFiles}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate>
                                <views:SftpFiles/>
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </TabItem>
                <TabItem Padding="16,8">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <fa:IconBlock Icon="Key" Style="{StaticResource FaIconInline}"/>
                            <TextBlock Text="HOLVI"/>
                        </StackPanel>
                    </TabItem.Header>
                    <ContentControl Content="{Binding Holvi}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate>
                                <views:HolviView/>
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </TabItem>
                <TabItem Padding="16,8">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <fa:IconBlock Icon="ListAlt" Style="{StaticResource FaIconInline}"/>
                            <TextBlock Text="VM Logs"/>
                        </StackPanel>
                    </TabItem.Header>
                    <TextBox Text="{Binding VmLog, Mode=OneWay}"
                             IsReadOnly="True"
                             Background="#0A0C0E"
                             Foreground="#E6EAF2"
                             FontFamily="Consolas"
                             BorderThickness="0"
                             Padding="12"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto"/>
                </TabItem>
            </TabControl>

            <ContentControl Content="{Binding TemplateManagement}">
                <ContentControl.Style>
                    <Style TargetType="ContentControl">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsTemplateSection}" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
                <ContentControl.ContentTemplate>
                    <DataTemplate>
                        <views:TemplateManagement/>
                    </DataTemplate>
                </ContentControl.ContentTemplate>
            </ContentControl>

            <ContentControl Content="{Binding Settings}">
                <ContentControl.Style>
                    <Style TargetType="ContentControl">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSettingsSection}" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
                <ContentControl.ContentTemplate>
                    <DataTemplate>
                        <views:Settings/>
                    </DataTemplate>
                </ContentControl.ContentTemplate>
            </ContentControl>
        </DockPanel>
            </DockPanel>
        </Grid>
    </Border>
</Window>


